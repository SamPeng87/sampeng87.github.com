---
layout: post
title: "面向对象之我感"
description: ""
category: 思想
tags: [面向对象]
---
{% include JB/setup %}

##所谓代码结构

最近换了新工作，新的团队也是第一次用Symfony2。这个框架号称的是企业级。完整的ORM，把Rails那套全搬过来了。各种命令行，各种配置文件。搞的我云里雾里的。

我还算得上是思维敏捷的了，但这个框架我是用得蛋都要碎了。写java写久了朋友都跟我说，java最好用的就是一堆配置，配置完了代码就差不多了。最难用的也是配置，各种配置属性要记。我擦Symfony2好的不学把坏的学来了。

首先，php本来就是一门直来直去的语言，我一直是不是很赞同框架用配置来组织的。所谓框架，是一整套的mvc结构。只要做好这几个分层就足够了。其他的工具都是辅助。那mvc其实是没有什么限制的。为什么要用配置来组织呢？一个好的代码结构，应该是由程序员对代码的精准切分和设计组织而来的。配置过于灵活就引入了复杂，过于死板就变成了苦逼。

其次，Symfony2框架和我以前用的tp框架有一个毛病，就是业务逻辑全在Controller层里面。那还叫毛的mvc啊。就叫vc算了啊。model都是一个AR模式的直接实现。这其实是没有含义的。我一直认为，所谓代码重用，不是重用数据结构，更多的是重用整个业务模型。全在Controller里了。咋来重用这个而业务模型呢？但是我记得10年我和流年聊过这个问题，其实thinkphp是提倡业务逻辑在model里面的。可是教程，手册全在congroller里面。Symfony也是一样。全在controller里面，我想设计者的本意也是额外引入一层作为业务逻辑层。但是直接在Controller层里面可以更好的让人理解。毕竟mvc这种模式新手理解起来确实有点复杂。

##所谓ORM

我在刚搞程序开发之前是先学的设计模式。所以对这一块很有感觉，到现在算起来满打满算也用设计模式用了3-4年了。当年一开始我也接触到orm这个概念。觉得牛b啊。这就是神器啊。还各种推广和说自己懂orm。

真的只有在应用到实际场景中才知道是何等的苦逼。java和rails是语言特性决定的。他可以那么干。php搞orm就是自己抽自己耳光子。做php业务开发久的都知道一个道理，php最好用的就是数组。那为嘛抛弃掉数组不用用纯粹的orm来做数据库操作呢？

况且orm的设计方式有n种。我学来做什么？装x用么？很多人都没有这种感觉，觉得orm写简单sql很简单。实际上呢？我的经验告诉我，用orm久了，虽然业务是抽象出来了。sql就忘记的干干净净了。orm重要还是sql重要呢？orm做报表是多苦逼你们知道么= =10来个表联查真有传说中那么舒坦？一条sql的事啊。。。orm的实现有n种，学会一种换一种又要重新学。。sql学会了。一通百通。。干啥都行。

还有一个问题，ORM的复杂度过高，企业虽然谈不上效率。我前天做了一个测试。查询一个列表页面,一页20个。关联6张表都要显示在列表里。多少条查询呢？20X6我勒个去。100页就逆天了。。600条查询。。Symfony怎么解决这个问题的呢？我擦，直接发明了个DQL。。。。最后还是变成了SQL。只是强制的连表查询。。这是要逆天啊？好好的sql不用绕个大圈绕回来了。我是个很懒的程序员，最反感做这种无用功了的。这样做的最直接的坏处。只有懂这个框架的人+懂所有的业务才能以后维护这块。但是用sql的呢？只要懂SQL。跟着代码里面的流程转一圈就知道怎么回事了。立马就能进行维护和扩展。

所以我记得10年有个人跟我说过，orm的最好应用场景就是简单的增删改查。稍微复杂点就直接上sql吧。。。

我在这几年的实践中也体验到了。。其实orm的主要作用就是数据库切换。话说php开发的应用程序有多少个会涉及到数据切换呢？就算数据切换了。。pdo干嘛用的。。。

结论：php里orm就用来简单的增删改查的sql映射就行了。复杂的。程序员来解决

##所谓面向对象

其实最终会回到一个原点，到底是以数据为中心还是以业务为中心。ORM和AR都是一种以数据为中心的面向对象编码思想。这不是银弹，他能解决的范围非常小。引入的复杂度我前面已经说过了。可以按下不表。

回头来说说以业务为中心，也是我现在所感悟到的。所谓以业务为中心，就是不把一个数据单元看成一个对象。而是以一个业务单元为一个中心。最后业务单元组成了一个业务模型。这样做的好处是，真正做到代码复用。不用重复复制代码。

举个例子，拿博客来说事吧，这个简单
    
    以前我常规的做法是一个BlogController，
    然后BlogController下面add啊，delete啊,list啊，index之类的。业务逻辑全在这里面
    接着。Blog数据是对数据库的一个映射的AR对象。
    然后就是View层了

这个例子的好处是三层清晰。不会混淆。坏处是什么？完全木法复用。。

请问我要怎么做才能把一套重用到另一个叫做论坛的业务逻辑里面去呢？mvc三者这件都是高度耦合的。没解耦。

看看我最近实践的一种分层方式
    
    Controller
        SearchController 供查询用的控制器
        BlogController  供博客源数据用的控制器
    Model
        Add            //所有增要用到的业务逻辑，以下类似
        Delete
        Edit
        Search
        Status
        Comment

窃以为，我换成这种分层，代码内部组织好了是可以做到代码重用的。要么继承要么组合。只要内部把操作的数据对象和sql单独放一块。或者外部再加一块数据库操作对象。这样就可以重用代码了。业务逻辑不变就直接拿继承过来。并替换掉操作的数据对象。完全可用~
    
就拿上面这个例子来说

    我原来写的代码如果编辑要用到删除和添加的逻辑。很困难。现在只要把这两个对象组合依赖进来就行了。依赖的是该对象的接口，而不是对象本身。轻松重用。

好了。。。废话了一大堆。算是对自己3年的面向对象经验的一个总结。

**一定要找到面向对象-复杂度的平衡点**

**一定要注意设计模式的最终目的是封装变化点**

忘记以上两点，就是自己给自己找麻烦



